generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum EventType {
  WEDDING
  MEETING
  INCENTIVE
  CONFERENCE
  EXHIBITION
}
enum InventoryCategory {
  TECHNICAL
  FURNITURE
  DECOR
  STAFF
  CATERING
  ACCOMMODATION
  FLOOR_SPACE
}

model User {
  id            String   @id @default(uuid())

  username      String   @unique
  fullName      String
  email         String   @unique
  passwordHash  String

  mobileNumber  String?
  address       String?
  city          String?
  state         String?
  country       String?

  events Event[]

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Location {
  code      String  @id   
  name      String
  country   String

  events Event[] @relation("EventLocation")
}

model Event {
  id            String   @id @default(uuid())
  eventCode     String
  isActive      Boolean
  type          EventType
  startDate     DateTime
  endDate       DateTime
  locationCode  String
  creatorId     String

  creator   User     @relation(fields: [creatorId], references: [id])
  location  Location @relation("EventLocation", fields: [locationCode], references: [code])

  vendors     EventVendor[]
  allocations EventInventoryAllocation[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Vendor {
  id            String   @id @default(uuid())
  name          String
  email         String   @unique
  passwordHash  String
  isActive      Boolean  @default(true)

  inventoryItems InventoryItem[]
  events         EventVendor[]

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model EventVendor {
  id       String @id @default(uuid())
  eventId  String
  vendorId String

  event  Event  @relation(fields: [eventId], references: [id])
  vendor Vendor @relation(fields: [vendorId], references: [id])

  @@unique([eventId, vendorId])
}

model InventoryItem {
  id            String   @id @default(uuid())
  vendorId      String
  name          String
  category      InventoryCategory
  totalQuantity Int

  description   String?
  metadata      Json?

  vendor Vendor @relation(fields: [vendorId], references: [id])
  allocations EventInventoryAllocation[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model EventInventoryAllocation {
  id                String @id @default(uuid())
  eventId           String
  inventoryItemId   String
  quantityAllocated Int

  event         Event         @relation(fields: [eventId], references: [id])
  inventoryItem InventoryItem @relation(fields: [inventoryItemId], references: [id])

  @@unique([eventId, inventoryItemId])
}